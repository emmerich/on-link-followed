{"version":3,"sources":["on-link-followed.min.js"],"names":["root","factory","exports","module","define","amd","this","modules","__webpack_require__","moduleId","installedModules","id","loaded","call","m","c","p","Object","defineProperty","value","_aTags","_windowOpen","_historyState","attachToAll","win","rootNode","emitter","attach","detachFromAll","detach","onLinkFollowed","emit","data","console","log","_emmerich_olf","listeners","on","listener","concat","length","offLinkFollowed","initWithWindow","init","window","document","body","removeFromWindow","remove","_slicedToArray","sliceIterator","arr","i","_arr","_n","_d","_e","undefined","_s","_i","Symbol","iterator","next","done","push","err","Array","isArray","TypeError","A_TAG","RIGHT_CLICK","getLinkFollowedPacket","ev","destination","currentTarget","href","type","params","element","target","onMouseDown","button","onClick","forEachATag","fn","aTags","getElementsByTagName","_aTagListeners","a","clickListener","mdListener","addEventListener","forEach","_ref","_ref2","node","_ref3","_ref4","name","handler","removeEventListener","WINDOW_OPEN","wrappedWindowOpen","url","args","winOpen","open","HISTORY_PUSHSTATE","HISTORY_REPLACESTATE","wrapped","method","state","title","history","location","historyPushState","pushState","historyReplaceState","replaceState"],"mappings":"CAAA,SAA2CA,EAAMC,GAC1B,gBAAZC,UAA0C,gBAAXC,QACxCA,OAAOD,QAAUD,IACQ,kBAAXG,SAAyBA,OAAOC,IAC9CD,UAAWH,GACe,gBAAZC,SACdA,QAAwB,eAAID,IAE5BD,EAAqB,eAAIC,KACxBK,KAAM,WACT,MAAgB,UAAUC,GAKhB,QAASC,GAAoBC,GAG5B,GAAGC,EAAiBD,GACnB,MAAOC,GAAiBD,GAAUP,OAGnC,IAAIC,GAASO,EAAiBD,IAC7BP,WACAS,GAAIF,EACJG,QAAQ,EAUT,OANAL,GAAQE,GAAUI,KAAKV,EAAOD,QAASC,EAAQA,EAAOD,QAASM,GAG/DL,EAAOS,QAAS,EAGTT,EAAOD,QAvBf,GAAIQ,KAqCJ,OATAF,GAAoBM,EAAIP,EAGxBC,EAAoBO,EAAIL,EAGxBF,EAAoBQ,EAAI,GAGjBR,EAAoB,KAK/B,SAASL,EAAQD,EAASM,GAE/B,YAEAS,QAAOC,eAAehB,EAAS,cAC7BiB,OAAO,GAGT,IAAIC,GAASZ,EAAoB,GAE7Ba,EAAcb,EAAoB,GAElCc,EAAgBd,EAAoB,GAEpCe,EAAc,SAAqBC,EAAKC,EAAUC,IAEpD,EAAIN,EAAOO,QAAQH,EAAKC,EAAUC,IAGlC,EAAIL,EAAYM,QAAQH,EAAKC,EAAUC,IAGvC,EAAIJ,EAAcK,QAAQH,EAAKC,EAAUC,IASvCE,EAAgB,SAAuBJ,EAAKC,IAC9C,EAAIL,EAAOS,QAAQL,EAAKC,IACxB,EAAIJ,EAAYQ,QAAQL,EAAKC,IAC7B,EAAIH,EAAcO,QAAQL,EAAKC,IAG7BK,EAAiB,SAAwBN,EAAKC,GAChD,GAAIC,IACFK,KAAM,SAAcC,GAClB,MAAOC,SAAQC,IAAIF,IAWvB,OANAR,GAAIW,eACFC,cAGFb,EAAYC,EAAKC,EAAUC,IAGzBW,GAAI,SAAYC,GAEd,MADAd,GAAIW,cAAcC,UAAYZ,EAAIW,cAAcC,UAAUG,OAAOD,GAC1Dd,EAAIW,cAAcC,UAAUI,OAAS,KAK9CC,EAAkB,SAAyBjB,EAAKC,GAClDG,EAAcJ,EAAKC,GACnBD,EAAIW,cAAgB,WACbX,GAAIW,cAGbjC,GAAAA,YACEwC,eAAgB,SAAwBlB,EAAKC,GAC3C,MAAOK,GAAeN,EAAKC,IAE7BkB,KAAM,WACJ,MAAOrC,MAAKoC,eAAeE,OAAQA,OAAOC,SAASC,OAErDC,iBAAkB,SAA0BvB,EAAKC,GAC/C,MAAOgB,GAAgBjB,EAAKC,IAE9BuB,OAAQ,WACN,MAAO1C,MAAKyC,iBAAiBH,OAAQA,OAAOC,SAASC,SAMpD,SAAS3C,EAAQD,GAEtB,YAEAe,QAAOC,eAAehB,EAAS,cAC7BiB,OAAO,GAGT,IAAI8B,GAAiB,WAAc,QAASC,GAAcC,EAAKC,GAAK,GAAIC,MAAeC,GAAK,EAAUC,GAAK,EAAWC,EAAKC,MAAW,KAAM,IAAK,GAAiCC,GAA7BC,EAAKR,EAAIS,OAAOC,cAAmBP,GAAMI,EAAKC,EAAGG,QAAQC,QAAoBV,EAAKW,KAAKN,EAAGvC,QAAYiC,GAAKC,EAAKb,SAAWY,GAA3DE,GAAK,IAAoE,MAAOW,GAAOV,GAAK,EAAMC,EAAKS,EAAO,QAAU,KAAWX,GAAMK,EAAG,WAAWA,EAAG,YAAe,QAAU,GAAIJ,EAAI,KAAMC,IAAQ,MAAOH,GAAQ,MAAO,UAAUF,EAAKC,GAAK,GAAIc,MAAMC,QAAQhB,GAAQ,MAAOA,EAAY,IAAIS,OAAOC,WAAY5C,QAAOkC,GAAQ,MAAOD,GAAcC,EAAKC,EAAa,MAAM,IAAIgB,WAAU,4DAEllBC,EAAQ,QACRC,EAAc,EAEdC,EAAwB,SAA+BC,GAIzD,OACEC,YAAaD,EAAGE,cAAcC,KAC9BC,KAAMP,EACNQ,QACEC,QAASN,EAAGE,cACZK,OAAQP,EAAGO,UAKbC,EAAc,SAAqBtD,GACrC,MAAO,UAAU8C,GACXA,EAAGS,SAAWX,GAChB5C,EAAQK,KAAK,sBAAuBwC,EAAsBC,MAK5DU,EAAU,SAAiBxD,GAC7B,MAAO,UAAU8C,GACf9C,EAAQK,KAAK,iBAAkBwC,EAAsBC,MAIrDW,EAAc,SAAqB1D,EAAU2D,GAG/C,IAAK,GAFDC,GAAQ5D,EAAS6D,qBAAqB,KAEjClC,EAAI,EAAGA,EAAIiC,EAAM7C,OAAQY,IAChCgC,EAAGC,EAAMjC,GAAIA,GAIJlD,GAAQyB,OAAS,SAAgBH,EAAKC,EAAUC,GAC3DF,EAAIW,cAAcoD,kBAElBJ,EAAY1D,EAAU,SAAU+D,GAC9B,GAAIC,GAAgBP,EAAQxD,GACxBgE,EAAaV,EAAYtD,EAE7BF,GAAIW,cAAcoD,eAAevB,MAAMwB,IAAK,QAASC,IAAiB,YAAaC,MAEnFF,EAAEG,iBAAiB,QAASF,GAC5BD,EAAEG,iBAAiB,YAAaD,MAIvBxF,EAAQ2B,OAAS,SAAgBL,EAAKC,GACjDD,EAAIW,cAAcoD,eAAeK,QAAQ,SAAUC,GACjD,GAAIC,GAAQ7C,EAAe4C,EAAM,GAE7BE,EAAOD,EAAM,GACb1D,EAAY0D,EAAM,EAEtB1D,GAAUwD,QAAQ,SAAUI,GAC1B,GAAIC,GAAQhD,EAAe+C,EAAO,GAE9BE,EAAOD,EAAM,GACbE,EAAUF,EAAM,EAEpBF,GAAKK,oBAAoBF,EAAMC,OAInC3E,EAAIW,cAAcoD,oBAKf,SAASpF,EAAQD,GAEtB,YAEAe,QAAOC,eAAehB,EAAS,cAC7BiB,OAAO,GAET,IAAIkF,GAAc,cAEdC,EAAoB,SAA2B9E,EAAKE,GACtD,MAAO,UAAU6E,EAAKxB,EAAQyB,GAC5B9E,EAAQK,KAAK,kBAAoB0C,YAAa8B,EAAK3B,KAAMyB,IACzD7E,EAAIW,cAAcsE,QAAQ5F,KAAKW,EAAK+E,EAAKxB,EAAQyB,IAIxCtG,GAAQyB,OAAS,SAAgBH,EAAKC,EAAUC,GAC3DF,EAAIW,cAAcsE,QAAUjF,EAAIkF,KAChClF,EAAIkF,KAAOJ,EAAkB9E,EAAKE,IAGvBxB,EAAQ2B,OAAS,SAAgBL,EAAKC,EAAUC,GAC3DF,EAAIkF,KAAOlF,EAAIW,cAAcsE,QAC7BjF,EAAIW,cAAcsE,QAAU,OAKzB,SAAStG,EAAQD,GAEtB,YAEAe,QAAOC,eAAehB,EAAS,cAC7BiB,OAAO,GAET,IAAIwF,GAAoB,oBACpBC,EAAuB,uBAEvBC,EAAU,SAAiBrF,EAAKE,EAASoF,EAAQlC,GACnD,MAAO,UAAUmC,EAAOC,EAAOT,GAC7B,IACEO,EAAOjG,KAAKW,EAAIyF,QAASF,EAAOC,EAAOT,GACvC,MAAOtC,GAIP,KAAMA,GAGRvC,EAAQK,KAAK,kBAAoB0C,YAAa7B,OAAOsE,SAASvC,KAAMC,KAAMA,KAIjE1E,GAAQyB,OAAS,SAAgBH,EAAKC,EAAUC,GAC3DF,EAAIW,cAAcgF,iBAAmB3F,EAAIyF,QAAQG,UACjD5F,EAAIW,cAAckF,oBAAsB7F,EAAIyF,QAAQK,aAEpD9F,EAAIyF,QAAQG,UAAYP,EAAQrF,EAAKE,EAASF,EAAIW,cAAcgF,iBAAkBR,GAClFnF,EAAIyF,QAAQK,aAAeT,EAAQrF,EAAKE,EAASF,EAAIW,cAAckF,oBAAqBT,IAG7E1G,EAAQ2B,OAAS,SAAgBL,EAAKC,GACjDD,EAAIyF,QAAQG,UAAY5F,EAAIW,cAAcgF,iBAC1C3F,EAAIyF,QAAQK,aAAe9F,EAAIW,cAAckF,oBAE7C7F,EAAIW,cAAcgF,iBAAmB,KACrC3F,EAAIW,cAAckF,oBAAsB","file":"on-link-followed.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"onLinkFollowed\"] = factory();\n\telse\n\t\troot[\"onLinkFollowed\"] = factory();\n})(this, function() {\nreturn /******/ (function(modules) { // webpackBootstrap\n/******/ \t// The module cache\n/******/ \tvar installedModules = {};\n/******/\n/******/ \t// The require function\n/******/ \tfunction __webpack_require__(moduleId) {\n/******/\n/******/ \t\t// Check if module is in cache\n/******/ \t\tif(installedModules[moduleId])\n/******/ \t\t\treturn installedModules[moduleId].exports;\n/******/\n/******/ \t\t// Create a new module (and put it into the cache)\n/******/ \t\tvar module = installedModules[moduleId] = {\n/******/ \t\t\texports: {},\n/******/ \t\t\tid: moduleId,\n/******/ \t\t\tloaded: false\n/******/ \t\t};\n/******/\n/******/ \t\t// Execute the module function\n/******/ \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n/******/\n/******/ \t\t// Flag the module as loaded\n/******/ \t\tmodule.loaded = true;\n/******/\n/******/ \t\t// Return the exports of the module\n/******/ \t\treturn module.exports;\n/******/ \t}\n/******/\n/******/\n/******/ \t// expose the modules object (__webpack_modules__)\n/******/ \t__webpack_require__.m = modules;\n/******/\n/******/ \t// expose the module cache\n/******/ \t__webpack_require__.c = installedModules;\n/******/\n/******/ \t// __webpack_public_path__\n/******/ \t__webpack_require__.p = \"\";\n/******/\n/******/ \t// Load entry module and return exports\n/******/ \treturn __webpack_require__(0);\n/******/ })\n/************************************************************************/\n/******/ ([\n/* 0 */\n/***/ function(module, exports, __webpack_require__) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _aTags = __webpack_require__(1);\n\t\n\tvar _windowOpen = __webpack_require__(2);\n\t\n\tvar _historyState = __webpack_require__(3);\n\t\n\tvar attachToAll = function attachToAll(win, rootNode, emitter) {\n\t  // Attach to A tags\n\t  (0, _aTags.attach)(win, rootNode, emitter);\n\t\n\t  // Overwrite window.open\n\t  (0, _windowOpen.attach)(win, rootNode, emitter);\n\t\n\t  // Overwrite history.pushState / history.replaceState\n\t  (0, _historyState.attach)(win, rootNode, emitter);\n\t\n\t  // Attach to onbeforeunload\n\t  // set window.location\n\t  // window.onpopstate?\n\t  // history.forward / history.back / history.go?\n\t  // Copy & paste url? - will do onbeforeunload\n\t};\n\t\n\tvar detachFromAll = function detachFromAll(win, rootNode) {\n\t  (0, _aTags.detach)(win, rootNode);\n\t  (0, _windowOpen.detach)(win, rootNode);\n\t  (0, _historyState.detach)(win, rootNode);\n\t};\n\t\n\tvar onLinkFollowed = function onLinkFollowed(win, rootNode) {\n\t  var emitter = {\n\t    emit: function emit(data) {\n\t      return console.log(data);\n\t    }\n\t  };\n\t\n\t  // internal object for storing state\n\t  win._emmerich_olf = {\n\t    listeners: []\n\t  };\n\t\n\t  attachToAll(win, rootNode, emitter);\n\t\n\t  return {\n\t    on: function on(listener) {\n\t      win._emmerich_olf.listeners = win._emmerich_olf.listeners.concat(listener);\n\t      return win._emmerich_olf.listeners.length - 1;\n\t    }\n\t  };\n\t};\n\t\n\tvar offLinkFollowed = function offLinkFollowed(win, rootNode) {\n\t  detachFromAll(win, rootNode);\n\t  win._emmerich_olf = null;\n\t  delete win._emmerich_olf;\n\t};\n\t\n\texports.default = {\n\t  initWithWindow: function initWithWindow(win, rootNode) {\n\t    return onLinkFollowed(win, rootNode);\n\t  },\n\t  init: function init() {\n\t    return this.initWithWindow(window, window.document.body);\n\t  },\n\t  removeFromWindow: function removeFromWindow(win, rootNode) {\n\t    return offLinkFollowed(win, rootNode);\n\t  },\n\t  remove: function remove() {\n\t    return this.removeFromWindow(window, window.document.body);\n\t  }\n\t};\n\n/***/ },\n/* 1 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\t\n\tvar _slicedToArray = function () { function sliceIterator(arr, i) { var _arr = []; var _n = true; var _d = false; var _e = undefined; try { for (var _i = arr[Symbol.iterator](), _s; !(_n = (_s = _i.next()).done); _n = true) { _arr.push(_s.value); if (i && _arr.length === i) break; } } catch (err) { _d = true; _e = err; } finally { try { if (!_n && _i[\"return\"]) _i[\"return\"](); } finally { if (_d) throw _e; } } return _arr; } return function (arr, i) { if (Array.isArray(arr)) { return arr; } else if (Symbol.iterator in Object(arr)) { return sliceIterator(arr, i); } else { throw new TypeError(\"Invalid attempt to destructure non-iterable instance\"); } }; }();\n\t\n\tvar A_TAG = 'A_TAG';\n\tvar RIGHT_CLICK = 2;\n\t\n\tvar getLinkFollowedPacket = function getLinkFollowedPacket(ev) {\n\t  // ev.target references the element that was clicked, but ev.currentTarget\n\t  // references the element that we attached the event handler to, so we know\n\t  // its an a tag\n\t  return {\n\t    destination: ev.currentTarget.href,\n\t    type: A_TAG,\n\t    params: {\n\t      element: ev.currentTarget,\n\t      target: ev.target\n\t    }\n\t  };\n\t};\n\t\n\tvar onMouseDown = function onMouseDown(emitter) {\n\t  return function (ev) {\n\t    if (ev.button === RIGHT_CLICK) {\n\t      emitter.emit('onMaybeLinkFollowed', getLinkFollowedPacket(ev));\n\t    }\n\t  };\n\t};\n\t\n\tvar onClick = function onClick(emitter) {\n\t  return function (ev) {\n\t    emitter.emit('onLinkFollowed', getLinkFollowedPacket(ev));\n\t  };\n\t};\n\t\n\tvar forEachATag = function forEachATag(rootNode, fn) {\n\t  var aTags = rootNode.getElementsByTagName('a');\n\t\n\t  for (var i = 0; i < aTags.length; i++) {\n\t    fn(aTags[i], i);\n\t  }\n\t};\n\t\n\tvar attach = exports.attach = function attach(win, rootNode, emitter) {\n\t  win._emmerich_olf._aTagListeners = [];\n\t\n\t  forEachATag(rootNode, function (a) {\n\t    var clickListener = onClick(emitter);\n\t    var mdListener = onMouseDown(emitter);\n\t\n\t    win._emmerich_olf._aTagListeners.push([a, [['click', clickListener], ['mousedown', mdListener]]]);\n\t\n\t    a.addEventListener('click', clickListener);\n\t    a.addEventListener('mousedown', mdListener);\n\t  });\n\t};\n\t\n\tvar detach = exports.detach = function detach(win, rootNode) {\n\t  win._emmerich_olf._aTagListeners.forEach(function (_ref) {\n\t    var _ref2 = _slicedToArray(_ref, 2);\n\t\n\t    var node = _ref2[0];\n\t    var listeners = _ref2[1];\n\t\n\t    listeners.forEach(function (_ref3) {\n\t      var _ref4 = _slicedToArray(_ref3, 2);\n\t\n\t      var name = _ref4[0];\n\t      var handler = _ref4[1];\n\t\n\t      node.removeEventListener(name, handler);\n\t    });\n\t  });\n\t\n\t  win._emmerich_olf._aTagListeners = [];\n\t};\n\n/***/ },\n/* 2 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar WINDOW_OPEN = 'WINDOW_OPEN';\n\t\n\tvar wrappedWindowOpen = function wrappedWindowOpen(win, emitter) {\n\t  return function (url, target, args) {\n\t    emitter.emit('onLinkFollowed', { destination: url, type: WINDOW_OPEN });\n\t    win._emmerich_olf.winOpen.call(win, url, target, args);\n\t  };\n\t};\n\t\n\tvar attach = exports.attach = function attach(win, rootNode, emitter) {\n\t  win._emmerich_olf.winOpen = win.open;\n\t  win.open = wrappedWindowOpen(win, emitter);\n\t};\n\t\n\tvar detach = exports.detach = function detach(win, rootNode, emitter) {\n\t  win.open = win._emmerich_olf.winOpen;\n\t  win._emmerich_olf.winOpen = null;\n\t};\n\n/***/ },\n/* 3 */\n/***/ function(module, exports) {\n\n\t'use strict';\n\t\n\tObject.defineProperty(exports, \"__esModule\", {\n\t  value: true\n\t});\n\tvar HISTORY_PUSHSTATE = 'HISTORY_PUSHSTATE';\n\tvar HISTORY_REPLACESTATE = 'HISTORY_REPLACESTATE';\n\t\n\tvar wrapped = function wrapped(win, emitter, method, type) {\n\t  return function (state, title, url) {\n\t    try {\n\t      method.call(win.history, state, title, url);\n\t    } catch (err) {\n\t      // pushState / replaceState will throw an exception if the domain cannot\n\t      // be reached. If that happens we don't want to fire onLinkFollowed, we\n\t      // want to rethrow the exception\n\t      throw err;\n\t    }\n\t\n\t    emitter.emit('onLinkFollowed', { destination: window.location.href, type: type });\n\t  };\n\t};\n\t\n\tvar attach = exports.attach = function attach(win, rootNode, emitter) {\n\t  win._emmerich_olf.historyPushState = win.history.pushState;\n\t  win._emmerich_olf.historyReplaceState = win.history.replaceState;\n\t\n\t  win.history.pushState = wrapped(win, emitter, win._emmerich_olf.historyPushState, HISTORY_PUSHSTATE);\n\t  win.history.replaceState = wrapped(win, emitter, win._emmerich_olf.historyReplaceState, HISTORY_REPLACESTATE);\n\t};\n\t\n\tvar detach = exports.detach = function detach(win, rootNode) {\n\t  win.history.pushState = win._emmerich_olf.historyPushState;\n\t  win.history.replaceState = win._emmerich_olf.historyReplaceState;\n\t\n\t  win._emmerich_olf.historyPushState = null;\n\t  win._emmerich_olf.historyReplaceState = null;\n\t};\n\n/***/ }\n/******/ ])\n});\n;\n//# sourceMappingURL=on-link-followed.js.map"],"sourceRoot":"/source/"}